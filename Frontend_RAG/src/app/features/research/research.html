<div class="research-container">
    <div class="research-header">
        <h1>AI Research</h1>
        <p class="subtitle">Discover trending topics and validated content ideas for your niche</p>
    </div>

    <!-- Input Section -->
    <div class="input-section">
        <div class="form-group">
            <label for="niche">Niche / Topic</label>
            <input 
                type="text" 
                id="niche" 
                [(ngModel)]="niche" 
                placeholder="e.g., personal finance, web development, fitness"
            />
        </div>

        <div class="form-group">
            <label for="subreddits">Subreddits (optional)</label>
            <input 
                type="text" 
                id="subreddits" 
                [(ngModel)]="subreddits" 
                placeholder="e.g., personalfinance, investing, financialindependence"
            />
            <span class="hint">Comma-separated, without r/</span>
        </div>

        <div class="form-group">
            <label for="ideaCount">Number of Ideas</label>
            <input 
                type="number" 
                id="ideaCount" 
                [(ngModel)]="ideaCount" 
                min="5" 
                max="50"
            />
        </div>

        <div class="button-group">
            <button class="btn-primary" (click)="runResearch()" [disabled]="isLoading">
                <svg *ngIf="!isLoading" class="icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"></circle>
                    <path d="m21 21-4.35-4.35"></path>
                </svg>
                <svg *ngIf="isLoading" class="icon spinner-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 12a9 9 0 1 1-6.219-8.56"></path>
                </svg>
                {{ isLoading ? 'Researching...' : 'Start Research' }}
            </button>
            <button class="btn-outline" (click)="clearAll()">Clear</button>
        </div>
    </div>

    <!-- Messages -->
    <div class="message error" *ngIf="errorMessage">{{ errorMessage }}</div>
    <div class="message success" *ngIf="successMessage">{{ successMessage }}</div>

    <!-- Loading -->
    <div class="loading-section" *ngIf="isLoading">
        <div class="spinner"></div>
        <p>Analyzing {{ niche }}...</p>
        <p class="hint">Scraping Reddit, Google Trends, and generating ideas</p>
    </div>

    <!-- Results -->
    <div class="results-section" *ngIf="report">
        <!-- Stats -->
        <div class="stats-bar">
            <div class="stat">
                <span class="value">{{ report.content_ideas.length }}</span>
                <span class="label">Ideas</span>
            </div>
            <div class="stat">
                <span class="value">{{ report.trending_topics.length }}</span>
                <span class="label">Trends</span>
            </div>
            <div class="stat">
                <span class="value">{{ report.pain_points.length }}</span>
                <span class="label">Pain Points</span>
            </div>
            <div class="stat">
                <span class="value">{{ report.questions.length }}</span>
                <span class="label">Questions</span>
            </div>
        </div>

        <!-- Tabs -->
        <div class="tabs">
            <button [class.active]="activeTab === 'ideas'" (click)="activeTab = 'ideas'">
                Content Ideas
            </button>
            <button [class.active]="activeTab === 'trending'" (click)="activeTab = 'trending'">
                Trending
            </button>
            <button [class.active]="activeTab === 'painpoints'" (click)="activeTab = 'painpoints'">
                Pain Points
            </button>
        </div>

        <!-- Ideas Tab -->
        <div class="tab-content" *ngIf="activeTab === 'ideas'">
            <div class="ideas-grid">
                @for (idea of report.content_ideas; track $index) {
                    <div class="idea-card">
                        <div class="idea-header">
                            <h3>{{ idea.title }}</h3>
                            <span class="confidence" [class]="getConfidenceClass(idea.confidence_score)">
                                {{ (idea.confidence_score * 100).toFixed(0) }}%
                            </span>
                        </div>
                        <p class="description">{{ idea.description }}</p>
                        <div class="idea-meta">
                            <span class="content-type">{{ idea.content_type }}</span>
                            <span class="sources">{{ idea.sources.join(', ') }}</span>
                        </div>
                        <div class="idea-pain" *ngIf="idea.pain_point">
                            <span class="label">Pain Point:</span> {{ idea.pain_point }}
                        </div>
                        <button class="btn-sm" (click)="copyIdea(idea)">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                            </svg>
                            Copy
                        </button>
                    </div>
                }
            </div>
        </div>

        <!-- Trending Tab -->
        <div class="tab-content" *ngIf="activeTab === 'trending'">
            <div class="trending-list">
                @for (topic of report.trending_topics; track $index) {
                    <div class="trending-item">
                        <span class="topic">{{ topic.topic }}</span>
                        <span class="source">{{ topic.source }}</span>
                        <span class="score">{{ topic.score }}</span>
                    </div>
                }
            </div>
        </div>

        <!-- Pain Points Tab -->
        <div class="tab-content" *ngIf="activeTab === 'painpoints'">
            <div class="painpoints-section">
                <h3>Pain Points</h3>
                <ul class="painpoints-list">
                    @for (pp of report.pain_points; track $index) {
                        <li>{{ pp }}</li>
                    }
                </ul>

                <h3>Questions People Ask</h3>
                <ul class="questions-list">
                    @for (q of report.questions; track $index) {
                        <li>{{ q }}</li>
                    }
                </ul>
            </div>
        </div>
    </div>
</div>
